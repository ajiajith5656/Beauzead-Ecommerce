type User {
  id: ID!
  email: String!
  first_name: String
  last_name: String
  phone: String
  address: String
  profile_type: String
  avatar_url: String
  is_verified: Boolean
  is_banned: Boolean
  created_at: String
  updated_at: String
}

type SubCategory {
  id: String!
  name: String!
  slug: String
  description: String
  image_url: String
}

type Category {
  id: ID!
  categoryId: String!
  name: String!
  slug: String
  description: String
  image_url: String
  parent_id: String
  sub_categories: [SubCategory]
  is_active: Boolean
  sort_order: Int
  created_at: String
  updated_at: String
}

type Product {
  id: ID!
  productId: String!
  name: String!
  slug: String
  description: String
  category: String
  price: Float!
  discount_price: Float
  stock: Int!
  sku: String
  brand: String
  images: [String]
  seller_id: String!
  approval_status: String
  is_active: Boolean!
  is_featured: Boolean
  tags: [String]
  specifications: String
  created_at: String
  updated_at: String
}

input SubCategoryInput {
  id: String
  name: String!
  slug: String
  description: String
  image_url: String
}

input CategoryInput {
  name: String!
  slug: String
  description: String
  image_url: String
  parent_id: String
  sub_categories: [SubCategoryInput]
  is_active: Boolean
  sort_order: Int
}

input ProductInput {
  name: String!
  slug: String
  description: String
  category: String
  price: Float!
  discount_price: Float
  stock: Int!
  sku: String
  brand: String
  images: [String]
  seller_id: String
  approval_status: String
  is_active: Boolean
  is_featured: Boolean
  tags: [String]
  specifications: String
}

type ProductConnection {
  items: [Product]
  nextToken: String
}

type UserConnection {
  items: [User]
  nextToken: String
}

type Query {
  getUser(id: ID!): User
  listUsers(limit: Int, nextToken: String): UserConnection
  getCategory(id: ID!): Category
  listCategories: [Category]
  getProduct(id: ID!): Product
  listProducts(limit: Int, nextToken: String): ProductConnection
  listProductsByStatus(approval_status: String!, limit: Int): [Product]
  listProductsBySeller(seller_id: String!, limit: Int): [Product]
}

type Mutation {
  banUser(id: ID!): User
  unbanUser(id: ID!): User
  deleteUser(id: ID!): Boolean
  
  createCategory(input: CategoryInput!): Category
  updateCategory(id: ID!, input: CategoryInput!): Category
  deleteCategory(id: ID!): Boolean
  addSubCategory(categoryId: ID!, subCategory: SubCategoryInput!): Category
  updateSubCategory(categoryId: ID!, subCategoryId: ID!, subCategory: SubCategoryInput!): Category
  removeSubCategory(categoryId: ID!, subCategoryId: ID!): Category
  
  createProduct(input: ProductInput!): Product
  updateProduct(id: ID!, input: ProductInput!): Product
  deleteProduct(id: ID!): Boolean
  approveProduct(id: ID!): Product
  rejectProduct(id: ID!): Product
  toggleProductStatus(id: ID!): Product
  
  # Stripe Payment Mutations
  createStripePaymentIntent(input: CreatePaymentIntentInput!): PaymentIntentResponse
  confirmPaymentAndCreateOrder(input: ConfirmPaymentInput!): ConfirmPaymentResponse
  processRefund(input: ProcessRefundInput!): RefundResponse
  processSellerPayout(input: ProcessPayoutInput!): PayoutResponse
}

# ===== Stripe Payment Input Types =====

input CreatePaymentIntentInput {
  customerId: String!
  customerEmail: String!
  customerName: String!
  items: [OrderItemInput!]!
  totalAmount: Float!
  shippingAddress: AddressInput!
}

input ConfirmPaymentInput {
  paymentIntentId: String!
  customerId: String!
  items: [OrderItemInput!]!
  shippingAddress: AddressInput!
  billingAddress: AddressInput!
  totalAmount: Float!
}

input ProcessRefundInput {
  orderId: String!
  refundAmount: Float!
  reason: String
}

input ProcessPayoutInput {
  sellerId: String!
  stripeAccountId: String!
}

input OrderItemInput {
  productId: String!
  productName: String!
  quantity: Int!
  price: Float!
  sellerId: String!
}

input AddressInput {
  street: String!
  city: String!
  state: String!
  postalCode: String!
  country: String!
}

# ===== Stripe Payment Response Types =====

type PaymentIntentResponse {
  success: Boolean!
  clientSecret: String
  paymentIntentId: String
  status: String
  amount: Float
  error: String
}

type ConfirmPaymentResponse {
  success: Boolean!
  orderId: String
  status: String
  paymentStatus: String
  error: String
}

type RefundResponse {
  success: Boolean!
  refundId: String
  status: String
  amount: Float
  error: String
}

type PayoutResponse {
  success: Boolean!
  payoutId: String
  amount: Float
  ordersProcessed: Int
  grossEarnings: Float
  platformFee: Float
  netPayout: Float
  error: String
}

schema {
  query: Query
  mutation: Mutation
}

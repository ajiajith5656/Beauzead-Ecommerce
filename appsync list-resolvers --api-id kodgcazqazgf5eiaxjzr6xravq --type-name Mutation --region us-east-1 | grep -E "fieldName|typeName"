{
    "resolver": {
        "typeName": "Mutation",
        "fieldName": "updateCategory",
        "dataSourceName": "CategoriesTableDataSource",
        "resolverArn": "arn:aws:appsync:us-east-1:422287834049:apis/kodgcazqazgf5eiaxjzr6xravq/types/Mutation/resolvers/updateCategory",
        "requestMappingTemplate": "#set($now = $util.time.nowISO8601())\n\n## Generate slug if not provided\n#if($ctx.args.input.slug && $ctx.args.input.slug != \"\")\n  #set($slug = $ctx.args.input.slug)\n#else\n  #set($slug = $ctx.args.input.name.toLowerCase().replaceAll(\"[^a-z0-9]+\", \"-\"))\n#end\n\n## Process sub_categories if provided\n#set($subCategories = [])\n#if($ctx.args.input.sub_categories && $ctx.args.input.sub_categories.size() > 0)\n  #foreach($sub in $ctx.args.input.sub_categories)\n    #set($subId = $sub.id)\n    #if(!$subId || $subId == \"\")\n      #set($subId = $util.autoId())\n    #end\n    #set($subSlug = $sub.slug)\n    #if(!$subSlug || $subSlug == \"\")\n      #set($subSlug = $sub.name.toLowerCase().replaceAll(\"[^a-z0-9]+\", \"-\"))\n    #end\n    #set($subCat = {\n      \"id\": $subId,\n      \"name\": $sub.name,\n      \"slug\": $subSlug\n    })\n    #if($sub.description)\n      $util.qr($subCat.put(\"description\", $sub.description))\n    #end\n    #if($sub.image_url)\n      $util.qr($subCat.put(\"image_url\", $sub.image_url))\n    #end\n    $util.qr($subCategories.add($subCat))\n  #end\n#end\n\n## Build update expression\n#set($expNames = {})\n#set($expValues = {})\n#set($expSet = [])\n\n$util.qr($expNames.put(\"#name\", \"name\"))\n$util.qr($expValues.put(\":name\", $util.dynamodb.toDynamoDBJson($ctx.args.input.name)))\n$util.qr($expSet.add(\"#name = :name\"))\n\n$util.qr($expNames.put(\"#slug\", \"slug\"))\n$util.qr($expValues.put(\":slug\", $util.dynamodb.toDynamoDBJson($slug)))\n$util.qr($expSet.add(\"#slug = :slug\"))\n\n$util.qr($expNames.put(\"#is_active\", \"is_active\"))\n$util.qr($expValues.put(\":is_active\", $util.dynamodb.toDynamoDBJson($ctx.args.input.is_active)))\n$util.qr($expSet.add(\"#is_active = :is_active\"))\n\n$util.qr($expNames.put(\"#updated_at\", \"updated_at\"))\n$util.qr($expValues.put(\":updated_at\", $util.dynamodb.toDynamoDBJson($now)))\n$util.qr($expSet.add(\"#updated_at = :updated_at\"))\n\n#if($ctx.args.input.description)\n  $util.qr($expNames.put(\"#description\", \"description\"))\n  $util.qr($expValues.put(\":description\", $util.dynamodb.toDynamoDBJson($ctx.args.input.description)))\n  $util.qr($expSet.add(\"#description = :description\"))\n#end\n\n#if($ctx.args.input.image_url)\n  $util.qr($expNames.put(\"#image_url\", \"image_url\"))\n  $util.qr($expValues.put(\":image_url\", $util.dynamodb.toDynamoDBJson($ctx.args.input.image_url)))\n  $util.qr($expSet.add(\"#image_url = :image_url\"))\n#end\n\n#if($ctx.args.input.parent_id)\n  $util.qr($expNames.put(\"#parent_id\", \"parent_id\"))\n  $util.qr($expValues.put(\":parent_id\", $util.dynamodb.toDynamoDBJson($ctx.args.input.parent_id)))\n  $util.qr($expSet.add(\"#parent_id = :parent_id\"))\n#end\n\n#if($ctx.args.input.sort_order)\n  $util.qr($expNames.put(\"#sort_order\", \"sort_order\"))\n  $util.qr($expValues.put(\":sort_order\", $util.dynamodb.toDynamoDBJson($ctx.args.input.sort_order)))\n  $util.qr($expSet.add(\"#sort_order = :sort_order\"))\n#end\n\n#if($subCategories.size() > 0)\n  $util.qr($expNames.put(\"#sub_categories\", \"sub_categories\"))\n  $util.qr($expValues.put(\":sub_categories\", $util.dynamodb.toDynamoDBJson($subCategories)))\n  $util.qr($expSet.add(\"#sub_categories = :sub_categories\"))\n#end\n\n{\n  \"version\": \"2017-02-28\",\n  \"operation\": \"UpdateItem\",\n  \"key\": {\n    \"categoryId\": $util.dynamodb.toDynamoDBJson($ctx.args.id)\n  },\n  \"update\": {\n    \"expression\": \"SET ${expSet.toString().replace('[','').replace(']','')}\",\n    \"expressionNames\": $util.toJson($expNames),\n    \"expressionValues\": $util.toJson($expValues)\n  }\n}\n",
        "responseMappingTemplate": "$util.toJson($ctx.result)\n",
        "kind": "UNIT",
        "maxBatchSize": 0
    }
}
